<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üöÄ Test Pipeline ERP Karizma - N8N</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2c5aa0, #1e3f73);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .content {
        padding: 40px;
      }

      .webhook-info {
        background: #f8f9fa;
        border-left: 4px solid #2c5aa0;
        padding: 20px;
        margin-bottom: 30px;
        border-radius: 8px;
      }

      .webhook-info h3 {
        color: #2c5aa0;
        margin-bottom: 10px;
      }

      .webhook-url {
        font-family: monospace;
        background: #e9ecef;
        padding: 10px;
        border-radius: 5px;
        word-break: break-all;
        font-size: 0.9em;
      }

      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .test-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s ease;
      }

      .test-card:hover {
        border-color: #2c5aa0;
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(44, 90, 160, 0.1);
      }

      .test-card h3 {
        color: #2c5aa0;
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .test-card .description {
        color: #6c757d;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .test-data {
        background: #e3f2fd;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 0.85em;
        margin-bottom: 15px;
        overflow-x: auto;
      }

      button {
        background: linear-gradient(135deg, #2c5aa0, #1e3f73);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        width: 100%;
        font-size: 1em;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(44, 90, 160, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none;
      }

      .result-section {
        margin-top: 30px;
        padding-top: 30px;
        border-top: 2px solid #e9ecef;
      }

      .result-section h3 {
        color: #2c5aa0;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      #result {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 25px;
        font-family: monospace;
        font-size: 0.9em;
        line-height: 1.6;
        min-height: 100px;
        white-space: pre-wrap;
        overflow-x: auto;
      }

      .loading {
        background: #fff3cd !important;
        border-color: #ffeaa7 !important;
        color: #856404;
      }

      .success {
        background: #d4edda !important;
        border-color: #c3e6cb !important;
        color: #155724;
      }

      .error {
        background: #f8d7da !important;
        border-color: #f5c6cb !important;
        color: #721c24;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .stat-item {
        text-align: center;
        padding: 15px;
        background: #e3f2fd;
        border-radius: 8px;
      }

      .stat-number {
        font-size: 1.8em;
        font-weight: bold;
        color: #2c5aa0;
      }

      .stat-label {
        font-size: 0.9em;
        color: #6c757d;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ Pipeline ERP Karizma</h1>
        <p>Test d'Int√©gration Automatis√©e - D√©velopp√© par Yassine Ammani</p>
      </div>

      <div class="content">
        <div class="webhook-info">
          <h3>üîó Configuration Webhook</h3>
          <p>URL d'int√©gration :</p>
          <div class="webhook-url" id="webhookUrl">
            https://yassproject.app.n8n.cloud/webhook-test/integration-erp
          </div>
        </div>

        <div class="test-grid">
          <div class="test-card">
            <h3>üè¢ Test Client Premium</h3>
            <div class="description">
              Client avec toutes les informations compl√®tes (score 100%)
            </div>
            <div class="test-data">
              { "nom": "Alpha Corporation", "email": "contact@alpha-corp.ma",
              "entreprise": "Alpha Corp", "secteur": "Finance", "telephone":
              "+212600123456" }
            </div>
            <button onclick="testClient1()">üöÄ Tester Client Premium</button>
          </div>

          <div class="test-card">
            <h3>üíª Test Client IT</h3>
            <div class="description">
              Client du secteur technologique (score 75%)
            </div>
            <div class="test-data">
              { "nom": "TechnoSoft", "email": "info@technosoft.ma",
              "entreprise": "TechnoSoft", "secteur": "IT" }
            </div>
            <button onclick="testClient2()">üíª Tester Client IT</button>
          </div>

          <div class="test-card">
            <h3>‚ö†Ô∏è Test Validation Erreur</h3>
            <div class="description">
              Test avec donn√©es manquantes pour validation
            </div>
            <div class="test-data">
              { "nom": "Test Error", "entreprise": "Error Corp" // Email
              manquant }
            </div>
            <button onclick="testError()">‚ö†Ô∏è Tester Erreur</button>
          </div>

          <div class="test-card">
            <h3>üè¶ Test Client Banking</h3>
            <div class="description">
              Grand client secteur bancaire (score 100%)
            </div>
            <div class="test-data">
              { "nom": "Bank of Africa", "email": "corporate@boa.ma",
              "entreprise": "BOA", "secteur": "Banking", "telephone":
              "+212522431010" }
            </div>
            <button onclick="testClient3()">üè¶ Tester Client Banking</button>
          </div>
        </div>

        <div class="result-section">
          <h3>üìä R√©sultats d'Int√©gration</h3>
          <div id="result">
            Cliquez sur un bouton de test pour voir les r√©sultats... üéØ Ce
            pipeline d√©montre : ‚Ä¢ Validation intelligente des donn√©es ‚Ä¢
            Enrichissement automatique ‚Ä¢ Scoring de qualit√© client ‚Ä¢ Int√©gration
            ERP simul√©e ‚Ä¢ API response structur√©e üíº Applicable directement chez
            Karizma pour l'int√©gration Odoo !
          </div>

          <div class="stats" id="stats" style="display: none">
            <div class="stat-item">
              <div class="stat-number" id="totalTests">0</div>
              <div class="stat-label">Tests Effectu√©s</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="successTests">0</div>
              <div class="stat-label">Succ√®s</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="errorTests">0</div>
              <div class="stat-label">Erreurs</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="avgScore">0</div>
              <div class="stat-label">Score Moyen</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const webhookUrl =
        "https://yassproject.app.n8n.cloud/webhook-test/integration-erp";
      let testStats = {
        total: 0,
        success: 0,
        errors: 0,
        scores: [],
      };

      async function makeRequest(data, testName) {
        const resultDiv = document.getElementById("result");
        const statsDiv = document.getElementById("stats");

        // Disable all buttons
        const buttons = document.querySelectorAll("button");
        buttons.forEach((btn) => (btn.disabled = true));

        resultDiv.className = "loading";
        resultDiv.innerHTML = `‚è≥ Test en cours: ${testName}...\n\nDonn√©es envoy√©es:\n${JSON.stringify(
          data,
          null,
          2
        )}`;

        try {
          const startTime = Date.now();

          const response = await fetch(webhookUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const responseTime = Date.now() - startTime;
          const result = await response.json();

          // Update stats
          testStats.total++;
          testStats.success++;
          if (result.score_qualite) {
            testStats.scores.push(result.score_qualite);
          }

          resultDiv.className = "success";
          resultDiv.innerHTML = `‚úÖ ${testName} - Succ√®s! (${responseTime}ms)

üì• DONN√âES ENVOY√âES:
${JSON.stringify(data, null, 2)}

üì§ R√âPONSE ERP:
${JSON.stringify(result, null, 2)}

üéØ POINTS CL√âS:
‚Ä¢ ID Client: ${result.client_id || "N/A"}
‚Ä¢ Score Qualit√©: ${result.score_qualite || "N/A"}%
‚Ä¢ Priorit√©: ${result.priorite || "N/A"}
‚Ä¢ Statut: Int√©gr√© avec succ√®s

üíº POUR KARIZMA:
Cette r√©ponse peut √™tre directement utilis√©e pour:
- Cr√©ation du client dans Odoo
- Assignation commerciale selon priorit√©
- Workflow de suivi automatis√©`;
        } catch (error) {
          testStats.total++;
          testStats.errors++;

          resultDiv.className = "error";
          resultDiv.innerHTML = `‚ùå ${testName} - Erreur!

üîç D√âTAILS DE L'ERREUR:
${error.message}

üì• DONN√âES ENVOY√âES:
${JSON.stringify(data, null, 2)}

üõ†Ô∏è DIAGNOSTIC:
‚Ä¢ V√©rifiez que le webhook N8N est actif
‚Ä¢ Confirmez l'URL du webhook
‚Ä¢ V√©rifiez la connectivit√© r√©seau

üí° POUR LA D√âMO:
Cette erreur fait partie des tests de validation!`;
        }

        // Update statistics
        updateStats();
        statsDiv.style.display = "grid";

        // Re-enable buttons
        buttons.forEach((btn) => (btn.disabled = false));
      }

      function updateStats() {
        document.getElementById("totalTests").textContent = testStats.total;
        document.getElementById("successTests").textContent = testStats.success;
        document.getElementById("errorTests").textContent = testStats.errors;

        const avgScore =
          testStats.scores.length > 0
            ? Math.round(
                testStats.scores.reduce((a, b) => a + b, 0) /
                  testStats.scores.length
              )
            : 0;
        document.getElementById("avgScore").textContent = avgScore + "%";
      }

      function testClient1() {
        makeRequest(
          {
            nom: "Alpha Corporation",
            email: "contact@alpha-corp.ma",
            entreprise: "Alpha Corp",
            secteur: "Finance",
            telephone: "+212600123456",
          },
          "Client Premium"
        );
      }

      function testClient2() {
        makeRequest(
          {
            nom: "TechnoSoft",
            email: "info@technosoft.ma",
            entreprise: "TechnoSoft",
            secteur: "IT",
          },
          "Client IT"
        );
      }

      function testError() {
        makeRequest(
          {
            nom: "Test Error",
            entreprise: "Error Corp",
            // Email manquant volontairement
          },
          "Validation Error"
        );
      }

      function testClient3() {
        makeRequest(
          {
            nom: "Bank of Africa",
            email: "corporate@boa.ma",
            entreprise: "BOA",
            secteur: "Banking",
            telephone: "+212522431010",
          },
          "Client Banking"
        );
      }

      // Auto-test on load (optional)
      setTimeout(() => {
        if (
          confirm(
            "Voulez-vous lancer un test automatique pour v√©rifier la connexion?"
          )
        ) {
          testClient2();
        }
      }, 1000);
    </script>
  </body>
</html>
